<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta</title>
    {% load bootstrap5 %}
    {% load static %}
    {% bootstrap_css%}
    {% bootstrap_javascript%}   

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,700' rel='stylesheet' type='text/css'>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="{% static 'css/jquery.toast.css' %}">   
    <link rel="stylesheet" href="{% static 'css/Create.css' %}">   

</head>

<body>
    <nav class="navbar navbar-expand-lg bg-success">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html" id="navColor">Hogares Verdes</a>
            <button 
                class="navbar-toggler" 
                type="button" 
                data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" 
                aria-controls="navbarSupportedContent" 
                aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="index.html" id="navColor">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Nosotros.html" id="navColor">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Catalogo.html" id="navColor">Catalogo</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

  <!-- Formulario -->
  <div class="container">
        <div class="form-container">
            <h3>Regístrate</h3>
            <form id="registration-form" action="#" method="post">
                <div class="form-group">
                    <label for="usuario">Nombre de usuario:</label>
                    <input type="text" id="usuario" name="usuario" required>
                <div class="error-message" id="username-error"></div>
                </div>
                <div class="form-group">
                    <label for="rut-input" class="form-label">Rut sin puntos y con
                        guion</label>
                    <input type="text" class="form-control" id="rut-input">
                    <span id="rut-error" style="color:red;"></span>
                    <div class="error-message" id="rut-error"></div>
                </div>
                <div class="form-group">
                    <label for="email">Correo electrónico:</label>
                    <input type="email" id="email" name="email" required>
                <div class="error-message" id="email-error"></div>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono de contacto:</label>
                    <input type="text" id="telefono" name="telefono" required class="soloNumeros" maxlength="15">
                    <div class="error-message" id="phone-error"></div>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" name="password" required>
                    <div class="error-message" id="password-error"></div>
                </div>
                <div classs="form-group">
                    <label for="cboRegiones">Regiones</label>
                    <select name="cboRegiones" id="cboRegiones" class="form-select
                            mb-3 col-md-4">
                        <option value="" disable hidden>Seleccione una opción</option>
                    </select>
        
                    <label for="cboComunas">Comunas</label>
                    <select name="cboComunas" id="cboComunas" class="form-select
                            mb-3 col-md-4" disabled>
                        <option value="" disable hidden>Seleccione una opción</option>
                    </select>
                </div>
                <div class="form-group">
                    <a href="index.html" class="btn btn-secondary">Volver</a>
                    &nbsp;&nbsp;
                    <input type="submit" value="Registrarse" class="btn btn-primary">
                </div>
            </form>
        </div>
  </div>
  <!-- Footer -->
  <div>
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3>Contacto</h3>
                    <ul>
                        <li>Teléfono: +56 9 3013 3886</li>
                        <li>Email: davi.salas@duocuc.cl</li>
                        <li>Dirección: Calle Principal, Ciudad</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h3>Servicios</h3>
                    <ul>
                        <li>Servicio 1</li>
                        <li>Servicio 2</li>
                        <li>Servicio 3</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
</div>

    <!-- Agrega el script para las validaciones -->
    <script type="text/javascript" src="js/jquery.toast.js"></script>    
    <script type="text/javascript" src="js/utiles.js"></script>

    <!--Script para validar que el rut exista evidentemente-->
    <script>
        function validarRut(rut) {
            if (!/^[0-9]+-[0-9kK]$/.test(rut)) {
                return false;
            }
    
            // separacion de DV
            var splitRut = rut.split('-');
            var num = splitRut[0];
            var dv = splitRut[1];
    
            // vemso el DV
            var suma = 0;
            var multiplo = 2;
            for (var i = num.length - 1; i >= 0; i--) {
                suma += num.charAt(i) * multiplo;
                if (multiplo < 7) {
                    multiplo += 1;
                } else {
                    multiplo = 2;
                }
            }
            var dvEsperado = 11 - (suma % 11);
    
            // Validamos el DV
            if (dvEsperado == 11) {
                dvEsperado = "0";
            } else if (dvEsperado == 10) {
                dvEsperado = "K";
            }
    
            return dv.toUpperCase() == dvEsperado;
        }
    
        function validarFormulario(event) {
            event.preventDefault();
            var rutInput = document.getElementById("rut-input");
            var rut = rutInput.value;
            var esValido = validarRut(rut);
            if (esValido) {
                // El RUT es válido, mando la alerta
                alert("El RUT es válido!");
            } else {
                // El RUT es inválido, mando la alerta
                alert("El RUT es inválido!");
            }
        }
    </script>
    <script>
        
        const form = document.getElementById('registration-form');

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            
            clearMessages();
            
            const rut = document.getElementById('rut-input').value;
            const usuario = document.getElementById('usuario').value;
            const email = document.getElementById('email').value;
            const telefono = document.getElementById('telefono').value;
            const password = document.getElementById('password').value;

            // Validaciones
            let isValid = true;

            // Validación de nombre de usuario
            if (usuario.trim() === '') {
                document.getElementById('username-error').textContent = 'Por favor, ingresa tu nombre de usuario.';
                isValid = false;
            }

            // Validación de que el campo del rut este lleno
            if (rut.trim() === '') {
                document.getElementById('rut-error').textContent = 'Por favor, ingresa el rut del usuario.';
                isValid = false;
            }

            // Validación de correo electrónico
            if (!isEmail(email)) {
                document.getElementById('email-error').textContent = 'Correo Electrónico ingresado no es una dirección email válida.';
                isValid = false;
            }

            // Validación de teléfono
            if (!$.isNumeric(telefono)) {
                document.getElementById('phone-error').textContent = 'Número de teléfono debe contener solo números.';
                isValid = false;
            }

            // Validación de contraseña
            if (password.trim() === '') {
                document.getElementById('password-error').textContent = 'Por favor, ingresa tu contraseña.';
                isValid = false;
            }

            // Si todos los campos son válidos, puedes enviar el formulario
            if (isValid) {
                form.submit();
            }
            else {
                $.toast({
                    heading: 'Atención!!!',
                    text: 'Existen campos con valores no válidos',
                    icon: 'warning',
                    loader: true,        // Change it to false to disable loader
                    loaderBg: '#9EC600'  // To change the background
                })
            }
        });

        function clearMessages() {
            document.getElementById('rut-error').textContent = '';
            document.getElementById('email-error').textContent = '';
            document.getElementById('username-error').textContent = '';
            document.getElementById('password-error').textContent = '';
            document.getElementById('phone-error').textContent = '';
        }
    </script>

    <script>
        //API AQUI NO FUNCIONA (al parecer esta inactiva y no encontre nada parecido que funcionara)
        $(document).ready(function () {
            var cboRegiones = $("#cboRegiones");
            $.ajax({
                url: "https://apis.digital.gob.cl/dpa/regiones",
                type: "GET",
                dataType: "jsonp",
                success: function (data) {
    
                    cboRegiones.append("<option value='' disabled selected>Seleccione una region</option>");
    
                    $.each(data, function (index, value) {
                        cboRegiones.append("<option value='" + value.codigo + "'>" + value.nombre + "</option>");
                    });
    
    
                    cboRegiones.prop("disabled", false);
                }
            });
    
    
            cboRegiones.on("change", function () {
                var codigoRegion = $(this).val();
                var cboComunas = $("#cboComunas");
    
    
                $.ajax({
                    url: "https://apis.digital.gob.cl/dpa//regiones/" + codigoRegion + "/comunas",
                    type: "GET",
                    dataType: "jsonp",
                    success: function (data) {
                        cboComunas.empty();
    
    
                        cboComunas.append("<option value='' disabled selected>Seleccione una comuna</option>");
    
    
                        $.each(data, function (index, value) {
                            cboComunas.append("<option value='" + value.codigo + "'>" + value.nombre + "</option>");
                        });
    
    
                        cboComunas.prop("disabled", false);
                    }
                });
            });
        });
    </script>
</body>

</html>